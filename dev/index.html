<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Coroutines for R • coro</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Coroutines for R">
<meta name="description" content="Provides coroutines for R, a family of functions that can be suspended and resumed later on. This includes async functions (which await) and generators (which yield). Async functions are based on the concurrency framework of the promises package. Generators are based on a dependency free iteration protocol defined in coro and are compatible with iterators from the reticulate package.">
<meta property="og:description" content="Provides coroutines for R, a family of functions that can be suspended and resumed later on. This includes async functions (which await) and generators (which yield). Async functions are based on the concurrency framework of the promises package. Generators are based on a dependency free iteration protocol defined in coro and are compatible with iterators from the reticulate package.">
<meta name="robots" content="noindex">
<script defer data-domain="coro.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">coro</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/generator.html">Generators</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/coro/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="coro">coro<a class="anchor" aria-label="anchor" href="#coro"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>coro implements <strong>coroutines</strong> for R, i.e. functions that can be suspended and resumed later on. There are two kinds:</p>
<ul>
<li>
<strong>Async</strong> functions, which make it straightforward to program concurrently</li>
<li>
<strong>Generators</strong> for iterating over complex sequences</li>
</ul>
<p>Supported features:</p>
<ul>
<li>Suspending within loops and if/else branches</li>
<li>Suspending within <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code>
</li>
<li>
<code><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit()</a></code> expressions and stack-based cleanup such as provided by <code>local_</code> functions in the <a href="https://github.com/r-lib/withr/" class="external-link">withr</a> package</li>
<li>Step-debugging and <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> within coroutines</li>
</ul>
<p>Compatibility with:</p>
<ul>
<li>Python iterators from the <a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a> package</li>
<li>Async operations from the <a href="https://github.com/rstudio/promises/" class="external-link">promises</a> package</li>
<li>Parallel computations from the <a href="https://github.com/HenrikBengtsson/future" class="external-link">future</a> package</li>
</ul>
<p>Attach the package to follow the examples:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/coro" class="external-link">coro</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="asyncawait-functions">Async/await functions<a class="anchor" aria-label="anchor" href="#asyncawait-functions"></a>
</h3>
<p>Concurrent programming is made straightforward by async-await functions. Whenever you are waiting for a result that may take a while (downloading a file, computing a value in an external process), use <code><a href="reference/async.html">await()</a></code>. The argument to <code><a href="reference/async.html">await()</a></code> must return a promise from the <a href="https://github.com/rstudio/promises/" class="external-link">promises</a> package.</p>
<p>Concurrent code based on promises can quickly become hard to write and follow. In the following artificial example, we wait for a download to complete, then decide to launch a computation in an external process depending on a property of the downloaded data. We also handle some errors specifically.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_async</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">async_download</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">then</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">then</span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu">future</span><span class="op">(</span><span class="fu">fib</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fib</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">data</span> <span class="op">/</span> <span class="va">fib</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">data</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span>, onRejected <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">err</span>, <span class="st">"download_error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="cn">NULL</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="va">err</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Rewriting this function with async/await greatly simplifies the code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_async</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/async.html">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="reference/async.html">await</a></span><span class="op">(</span><span class="fu">async_download</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    download_error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fib</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/async.html">await</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu">future</span><span class="op">(</span><span class="fu">fib</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">/</span><span class="va">fib</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generators">Generators<a class="anchor" aria-label="anchor" href="#generators"></a>
</h3>
<p>Generators are based on a simple iteration protocol:</p>
<ul>
<li>Iterators are functions.</li>
<li>They can be advanced by calling the function. The new value is returned.</li>
<li>An exhausted iterator returns the sentinel symbol <code>exhausted</code>.</li>
</ul>
<p>The <code><a href="reference/generator.html">generator()</a></code> function creates a generator factory which returns generator instances:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a generator factory</span></span>
<span><span class="va">generate_abc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generator.html">generator</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="reference/yield.html">yield</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a generator instance</span></span>
<span><span class="va">abc</span> <span class="op">&lt;-</span> <span class="fu">generate_abc</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>A generator instance is an iterator function which yields values:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abc</span></span>
<span><span class="co">#&gt; &lt;generator/instance&gt;</span></span>
<span><span class="co">#&gt; function () </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     for (x in letters[1:3]) {</span></span>
<span><span class="co">#&gt;         yield(x)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;environment: 0x1258e3818&gt;</span></span>
<span></span>
<span><span class="fu">abc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a"</span></span></code></pre></div>
<p>Collect all remaining values from an iterator with <code><a href="reference/collect.html">collect()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/collect.html">collect</a></span><span class="op">(</span><span class="va">abc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "b"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "c"</span></span></code></pre></div>
<p>Iterate over an iterator with <code><a href="reference/collect.html">loop()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="fu">generate_abc</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A"</span></span>
<span><span class="co">#&gt; [1] "B"</span></span>
<span><span class="co">#&gt; [1] "C"</span></span></code></pre></div>
<p>See <code><a href="articles/generator.html">vignette("generator")</a></code> for more information.</p>
</div>
<div class="section level3">
<h3 id="compatibility-with-the-reticulate-package">Compatibility with the reticulate package<a class="anchor" aria-label="anchor" href="#compatibility-with-the-reticulate-package"></a>
</h3>
<p>Python iterators imported with the <a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a> package are compatible with <code><a href="reference/collect.html">loop()</a></code> and <code><a href="reference/collect.html">collect()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_run.html" class="external-link">py_run_string</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">def first_n(n):</span></span>
<span><span class="st">    num = 1</span></span>
<span><span class="st">    while num &lt;= n:</span></span>
<span><span class="st">        yield num</span></span>
<span><span class="st">        num += 1</span></span>
<span><span class="st">"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/collect.html">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">py</span><span class="op">$</span><span class="fu">first_n</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>They can also be composed with coro generators:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generator.html">generator</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">it</span>, <span class="va">n</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">it</span><span class="op">)</span> <span class="fu"><a href="reference/yield.html">yield</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">composed</span> <span class="op">&lt;-</span> <span class="fu">times</span><span class="op">(</span><span class="va">py</span><span class="op">$</span><span class="fu">first_n</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/collect.html">collect</a></span><span class="op">(</span><span class="va">composed</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 30</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p><code><a href="reference/yield.html">yield()</a></code> and <code><a href="reference/async.html">await()</a></code> can be used in loops, if/else branches, <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> expressions, or any combinations of these. However they can’t be used as function arguments. These will cause errors:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/generator.html">generator</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/yield.html">yield</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/async.html">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="reference/async.html">await</a></span><span class="op">(</span><span class="fu">foo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Fortunately it is easy to rewrite the code to work around this limitation:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/generator.html">generator</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/yield.html">yield</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/async.html">async</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/async.html">await</a></span><span class="op">(</span><span class="fu">foo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-does-it-work">How does it work<a class="anchor" aria-label="anchor" href="#how-does-it-work"></a>
</h2>
<p>Coroutines are an <a href="https://eli.thegreenplace.net/2009/08/29/co-routines-as-an-alternative-to-state-machines" class="external-link">abstraction for state machines</a> in languages that support them. Conversely, you can implement coroutines by rewriting the code source provided by the user as a state machine. Pass <code>internals = TRUE</code> to the print methods of coroutines to reveal the state machine that is running under the hood:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">generate_abc</span>, internals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;generator&gt;</span></span>
<span><span class="co">#&gt; function () </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     for (x in letters[1:3]) {</span></span>
<span><span class="co">#&gt;         yield(x)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;environment: 0x1258e3818&gt;</span></span>
<span><span class="co">#&gt; State machine:</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (exhausted) {</span></span>
<span><span class="co">#&gt;         return(invisible(exhausted()))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     repeat switch(state[[1L]], `1` = {</span></span>
<span><span class="co">#&gt;         iterators[[2L]] &lt;- as_iterator(user(letters[1:3]))</span></span>
<span><span class="co">#&gt;         state[[1L]] &lt;- 2L</span></span>
<span><span class="co">#&gt;         state[[2L]] &lt;- 1L</span></span>
<span><span class="co">#&gt;     }, `2` = {</span></span>
<span><span class="co">#&gt;         repeat switch(state[[2L]], `1` = {</span></span>
<span><span class="co">#&gt;             if ({</span></span>
<span><span class="co">#&gt;                 iterator &lt;- iterators[[2L]]</span></span>
<span><span class="co">#&gt;                 if (is_exhausted(elt &lt;- iterator())) {</span></span>
<span><span class="co">#&gt;                   FALSE</span></span>
<span><span class="co">#&gt;                 } else {</span></span>
<span><span class="co">#&gt;                   user_env[["x"]] &lt;- elt</span></span>
<span><span class="co">#&gt;                   TRUE</span></span>
<span><span class="co">#&gt;                 }</span></span>
<span><span class="co">#&gt;             }) {</span></span>
<span><span class="co">#&gt;                 state[[2L]] &lt;- 2L</span></span>
<span><span class="co">#&gt;             } else {</span></span>
<span><span class="co">#&gt;                 break</span></span>
<span><span class="co">#&gt;             }</span></span>
<span><span class="co">#&gt;         }, `2` = {</span></span>
<span><span class="co">#&gt;             user({</span></span>
<span><span class="co">#&gt;                 x</span></span>
<span><span class="co">#&gt;             })</span></span>
<span><span class="co">#&gt;             state[[2L]] &lt;- 3L</span></span>
<span><span class="co">#&gt;             suspend()</span></span>
<span><span class="co">#&gt;             return(last_value())</span></span>
<span><span class="co">#&gt;         }, `3` = {</span></span>
<span><span class="co">#&gt;             .last_value &lt;- if (missing(arg)) NULL else arg</span></span>
<span><span class="co">#&gt;             state[[2L]] &lt;- 1L</span></span>
<span><span class="co">#&gt;         })</span></span>
<span><span class="co">#&gt;         iterators[[2L]] &lt;- NULL</span></span>
<span><span class="co">#&gt;         length(state) &lt;- 1L</span></span>
<span><span class="co">#&gt;         break</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     exhausted &lt;- TRUE</span></span>
<span><span class="co">#&gt;     invisible(exhausted())</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Despite this transformation of source code, <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> and step-debugging still work as you would expect. This is because coro keeps track of the source references from the original code.</p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<ul>
<li><p>The <a href="https://facebook.github.io/regenerator/" class="external-link">regenerator</a> Javascript package which uses a similar transformation to implement generators and async functions in older versions of Javascript.</p></li>
<li><p>Gabor Csardi for many interesting discussions about concurrency and the design of coro.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the development version from github with:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"r-lib/coro"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the coro project is released with a <a href="https://coro.r-lib.org/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=coro" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/r-lib/coro/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/r-lib/coro/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing coro</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/lionel-" class="external-link">Lionel Henry</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=coro" class="external-link"><img src="https://www.r-pkg.org/badges/version/coro" alt="CRAN status"></a></li>
<li><a href="https://github.com/r-lib/coro/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/coro/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>

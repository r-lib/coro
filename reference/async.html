<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Make an async function — async • coro</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Make an async function — async"><meta property="og:description" content="async() functions are building blocks for cooperative
concurrency.
They are concurrent because they are jointly managed by a
scheduler in charge of running them.
They are cooperative because they decide on their own when they
can no longer make quick progress and need to await some
result. This is done with the await() keyword which suspends
the async function and gives control back to the scheduler. The
scheduler waits until the next async operation is ready to make
progress.


The async framework used by async() functions is implemented in
the later and
promises packages:
You can chain async functions created with coro to promises.
You can await promises. You can also await futures created with
the future package
because they are coercible to promises.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/generator.html">Generators</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/r-lib/coro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Make an async function</h1>
    <small class="dont-index">Source: <a href="https://github.com/r-lib/coro/blob/HEAD/R/async.R" class="external-link"><code>R/async.R</code></a></small>
    <div class="hidden name"><code>async.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>async()</code> functions are building blocks for cooperative
concurrency.</p><ul><li><p>They are <em>concurrent</em> because they are jointly managed by a
scheduler in charge of running them.</p></li>
<li><p>They are <em>cooperative</em> because they decide on their own when they
can no longer make quick progress and need to <strong>await</strong> some
result. This is done with the <code>await()</code> keyword which suspends
the async function and gives control back to the scheduler. The
scheduler waits until the next async operation is ready to make
progress.</p></li>
</ul><p>The async framework used by <code>async()</code> functions is implemented in
the <a href="https://github.com/r-lib/later/" class="external-link">later</a> and
<a href="https://rstudio.github.io/promises/" class="external-link">promises</a> packages:</p><ul><li><p>You can chain async functions created with coro to promises.</p></li>
<li><p>You can await promises. You can also await futures created with
the <a href="https://github.com/HenrikBengtsson/future" class="external-link">future</a> package
because they are coercible to promises.</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">async</span><span class="op">(</span><span class="va">fn</span><span class="op">)</span>

<span class="fu">await</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>fn</dt>
<dd><p>An anonymous function within which <code>await()</code> calls are
allowed.</p></dd>
<dt>x</dt>
<dd><p>An awaitable value, i.e. a <a href="https://rstudio.github.io/promises//reference/promise.html" class="external-link">promise</a>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A function that returns a <code><a href="https://rstudio.github.io/promises//reference/promise.html" class="external-link">promises::promise()</a></code>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="async_generator.html">async_generator()</a></code> and <code><a href="async_generator.html">await_each()</a></code>;
<code><a href="coro_debug.html">coro_debug()</a></code> for step-debugging.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># This async function counts down from `n`, sleeping for 2 seconds</span></span>
<span class="r-in"><span class="co"># at each iteration:</span></span>
<span class="r-in"><span class="va">async_count_down</span> <span class="op">&lt;-</span> <span class="fu">async</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="kw">while</span> <span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Down"</span>, <span class="va">n</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span class="r-in">    <span class="fu">await</span><span class="op">(</span><span class="fu"><a href="async_sleep.html">async_sleep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span></span>
<span class="r-in">  <span class="op">}</span></span>
<span class="r-in"><span class="op">}</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># This async function counts up until `stop`, sleeping for 0.5</span></span>
<span class="r-in"><span class="co"># seconds at each iteration:</span></span>
<span class="r-in"><span class="va">async_count_up</span> <span class="op">&lt;-</span> <span class="fu">async</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">stop</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span class="r-in">  <span class="kw">while</span> <span class="op">(</span><span class="va">n</span> <span class="op">&lt;=</span> <span class="va">stop</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Up"</span>, <span class="va">n</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span class="r-in">    <span class="fu">await</span><span class="op">(</span><span class="fu"><a href="async_sleep.html">async_sleep</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span class="r-in">  <span class="op">}</span></span>
<span class="r-in"><span class="op">}</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># You can run these functions concurrently using `promise_all()`</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu">promises</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/promises//reference/promise_all.html" class="external-link">promise_all</a></span><span class="op">(</span><span class="fu">async_count_down</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="fu">async_count_up</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lionel Henry.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

